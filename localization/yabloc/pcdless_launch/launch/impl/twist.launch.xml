<launch>
    <arg name="use_sim_time" default="true"/>
    <arg name="ignore_less_than_float" default="true"/>
    <arg name="static_scale_factor" default="-1.0" description="if negative value, static_scale_factor is not used"/>
    <arg name="static_gyro_bias" default="10.0" description="if larger than 1, static_gyro_bias is not used"/>

    <!-- twist estimator -->
    <group>
        <push-ros-namespace namespace="kalman"/>

        <arg name="output_twist" default="twist"/>
        <arg name="output_doppler" default="doppler"/>
        <arg name="output_status" default="status"/>
        <arg name="output_doppler_vel" default="doppler_vel"/>
        <arg name="output_twist_with_cov" default="twist_with_cov"/>

        <node name="twist_estimator" pkg="twist_estimator" exec="twist_estimator_node" output="screen" args="--ros-args --log-level warn">
            <param name="use_sim_time" value="$(var use_sim_time)"/>
            <param name="ignore_less_than_float" value="$(var ignore_less_than_float)"/>
            <param name="static_scale_factor" value="$(var static_scale_factor)"/>
            <param name="static_gyro_bias" value="$(var static_gyro_bias)"/>

            <remap from="twist" to="$(var output_twist)"/>
            <remap from="doppler" to="$(var output_doppler)"/>
            <remap from="status" to="$(var output_status)"/>
            <remap from="doppler_vel" to="$(var output_doppler_vel)"/>
            <remap from="twist_with_cov" to="$(var output_twist_with_cov)"/>
        </node>
    </group>

    <node name="twist_visualizer" pkg="twist_estimator" exec="twist_visualizer_node" output="screen" args="--ros-args --log-level warn">
        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <remap from="/vehicle/status/twist" to="/localization/twist/kalman/twist"/>
    </node>

    <!-- velocity report converter -->
    <node name="velocity_report_node" pkg="twist_converter" exec="velocity_report_converter" output="screen" args="--ros-args --log-level warn">
        <param name="use_sim_time" value="$(var use_sim_time)"/>
    </node>

    <!-- pose twist fuser-->
    <node name="pose_twist_fuser" pkg="twist_converter" exec="pose_twist_fuser" output="log" args="--ros-args --log-level warn">
        <remap from="twist" to="/localization/trajectory/kalman/twist"/>
        <remap from="pose" to="/localization/pf/particle_pose"/>
        <remap from="odometry" to="/localization/kinematic_state"/>
    </node>

</launch>
