<launch>
    <!-- ========================================= -->
    <arg name="use_sim_time" default="true"/>
    <arg name="log_level" default="warn"/>
    <arg name="fuse_measurement" default="true"/>

    <!-- ========================================= -->
    <node pkg="modularized_particle_filter" exec="predictor" name="predictor" output="screen" args="--ros-args --log-level $(var log_level)">
        <remap from="twist" to="/eagleye/twist" />
        <remap from="twist_with_covariance" to="/eagleye/twist_with_covariance" />
        <remap from="initialpose" to="/initialpose" />
        <remap from="gnss/pose_with_covariance" to="/eagleye/pose_with_covariance"/>

        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <param name="num_of_particles" value="200" />
        <param name="resampling_interval_seconds" value="2.0" />
        <param name="prediction_rate" value="50.0" />

        <param name="static_linear_covariance" value="0.09" />
        <param name="static_angular_covariance" value="0.01" />
    </node>

    <node pkg="modularized_particle_filter" exec="gnss_pose_corrector" name="gnss_pose_corrector" args="--ros-args --log-level $(var log_level)">
        <remap from="weighted_particles" to="/weighted_particles" />
        <remap from="pose_with_covariance" to="/eagleye/pose_with_covariance" />

        <param name="particles_buffer_size" value="50" />
        <param name="flat_radius" value="5.0" />
    </node>

    <node pkg="modularized_particle_filter" exec="camera_pose_corrector" name="camera_pose_corrector" args="--ros-args --log-level info" output="screen">
        <remap from="/weighted_particles" to="/test/weighted_particles"/>
        <param name="image_size" value="800"/>
        <param name="max_range" value="20.0"/>
        <param name="score_threshold" value="3.0"/>
    </node>

    
    <!-- ========================================= -->
    <node pkg="modularized_particle_filter" exec="particle_visualize" name="particle_array_to_marker_array" output="screen">
        <remap from="/particle_array" to="/test/weighted_particles" />
        <remap from="/marker_array" to="/camera/weighted_particles/marker_array" />
    </node>
</launch>