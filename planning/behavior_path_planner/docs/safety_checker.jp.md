### SafetyChecker

SafetyCheckerは、与えられたパスが動的障害物と衝突するかどうかを確認する安全性チェッククラスです。

## Purpose / Role

行動パスプランナーにおいて、特定のモジュール（例えば、レーンチェンジ）は自己車両の安全なナビゲーションを確保するために、動的障害物との衝突チェックを行う必要があります。このユーティリティクラスは、他の道路利用者との安全性チェックを行う際に使うことのできる汎用性の高いクラスの定義を目指します。

### Assumptions

SafetyCheckerモジュールは、以下の前提条件に基づいています：

ユーザーは、自己車両と動的障害物の位置、速度、形状をユーティリティ関数に提供する必要があります。
自己車両と動的障害物の予測パスの各点のヨー角は、パスの次の点を指すべきです。
SafetyCheckerモジュールはRSS距離を用いて、他のオブジェクトとの潜在的な衝突の安全性を判断します。

### Limitations

現在のところ、動的障害物の予測パスの各点のヨー角は次の点を指していません。そのため、SafetyChecker関数は一部のエッジケースで不正確な結果を返す可能性があります。

### Inner working / Algorithm

SafetyCheckerのアルゴリズムの流れは、以下の説明で述べられています。

safety_check_flow

isPathSafe: パスが安全であるかどうかを判断するメソッド。パスと自己車両のオドメトリを引数として受け取り、パスが安全であれば true、そうでなければ false を返します。

createPredictedPath: 予測パスを生成するメソッド。自己車両の現在の速度、目標速度、加速度、自己車両の姿勢、時間分解能、停止時間に基づいて予測パスを作成します。

getBackwardLanelets: 後方のlaneletsを取得するメソッド。ルートハンドラー、ターゲットレーン、自己車両の姿勢を引数として受け取り、後方のlaneletsを返します。安全確認の対象となるエリアを取得することを目的として利用します。

filterObjectIndices: オブジェクトのインデックスをフィルタリングするメソッド。ロードオブジェクトのリスト、フィルタ関数を引数として受け取り、インデックスのリストを返します。

getEgoExpectedPoseAndConvertToPolygon: 自己車両の予想姿勢を生成し、それを多角形に変換するメソッド。この多角形は、後続のメソッドで衝突チェックに使用されます。

isSafeInLaneletCollisionCheck: lanelet間での衝突をチェックするメソッド。衝突がなければ true を返し、あれば false を返します。

isObjectIndexIncluded: 指定したインデックスが動的オブジェクトのリストのインデックスに含まれているかどうかを確認するメソッド。

isTargetObjectFront: 指定したオブジェクトが自己車両の前方にあるかどうかを判断するメソッド。前方にあれば true を返し、そうでなければ false を返します。

これらのメソッドを使用して、自己車両の予測パスが他の道路利用者と衝突する可能性があるかどうかを判断することができます。

### How to use

SafetyCheckerのインスタンスを生成する際には、SafetyCheckParamsおよびSafetyCheckDataという構造体を定義して、それらを引数に与える必要があります。

SafetyCheckParams
この構造体は、安全性チェックのパラメータを保持します。具体的なパラメータは、チェックの対象となる動的障害物の形状やサイズ、自己車両の速度や位置、予測パスの生成に関する設定などを含みます。

SafetyCheckData
この構造体は、安全性チェックに必要なデータを保持します。具体的なデータは、チェックの対象となる動的障害物の現在の状態、自己車両の現在の状態、ルートハンドラー、その他の関連データなどを含みます。

### Future wotk

このクラスの汎用性を高めるために他のモジュールで実装されている安全確認機能をシンプルに実現する方法を検討する方法がある。
